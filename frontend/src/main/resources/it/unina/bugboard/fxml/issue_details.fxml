<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.ScrollPane?>
<?import javafx.scene.control.SplitPane?>
<?import javafx.scene.control.TextArea?>
<?import javafx.scene.image.ImageView?>
<?import javafx.scene.layout.BorderPane?>
<?import javafx.scene.layout.FlowPane?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.Region?>
<?import javafx.scene.layout.VBox?>

<BorderPane xmlns="http://javafx.com/javafx/21"
            xmlns:fx="http://javafx.com/fxml/1"
            fx:controller="it.unina.bugboard.issuedetails.DettaglioIssueController"
            stylesheets="@../css/issue_details.css"
            styleClass="main-container"
            prefWidth="1200" prefHeight="800">

    <!-- Header -->
    <top>
        <HBox alignment="CENTER_LEFT" spacing="20" styleClass="header-bar" prefHeight="70">
            <Button text="← Indietro" onAction="#tornaIndietro" styleClass="back-btn"/>
            <Label text="Dettaglio Issue" styleClass="page-title"/>
            <Region HBox.hgrow="ALWAYS"/>
            <HBox spacing="10" alignment="CENTER_RIGHT">
                <Button fx:id="btnModifica" text="Modifica" onAction="#abilitaModifica" styleClass="action-button" style="-fx-background-color: #2980B9; -fx-text-fill: white;"/>
                <Button fx:id="btnSalva" text="Salva" onAction="#salvaModifiche" visible="false" managed="false" styleClass="action-button" style="-fx-background-color: #27AE60; -fx-text-fill: white;"/>
                <Button fx:id="btnAnnulla" text="Annulla" onAction="#annullaModifiche" visible="false" managed="false" styleClass="action-button" style="-fx-background-color: #7F8C8D; -fx-text-fill: white;"/>
            </HBox>
        </HBox>
    </top>

    <!-- Main Content Split -->
    <center>
        <SplitPane dividerPositions="0.6" styleClass="split-pane">

            <!-- LEFT PANE: Issue Details -->
            <ScrollPane fitToWidth="true" styleClass="details-scroll">
                <VBox spacing="20" styleClass="details-panel">
                    <padding><Insets top="20" right="20" bottom="20" left="20"/></padding>

                    <!-- New Layout Structure -->
                    <VBox spacing="10">
                        <!-- Title -->
                        <Label fx:id="labelTitolo" text="Titolo dell'issue..." styleClass="issue-title" wrapText="true"/>

                        <!-- Date -->
                        <Label fx:id="labelDataCreazione" styleClass="issue-date" text="Aperta il: ..."/>

                        <!-- Status/Priority/Type Row -->
                        <VBox spacing="10">
                            <!-- STATO -->
                            <HBox alignment="CENTER_LEFT" spacing="10">
                                <Label text="Stato :" styleClass="field-label" style="-fx-font-weight: bold;"/>
                                <Label fx:id="labelStato" text="APERTA" styleClass="status-badge" style="-fx-background-color: #FFF3CD; -fx-text-fill: #856404;"/>
                                <javafx.scene.control.ComboBox fx:id="cmbStato" visible="false" managed="false"/>
                            </HBox>

                            <!-- TIPOLOGIA -->
                            <HBox alignment="CENTER_LEFT" spacing="10">
                                <Label text="Tipologia :" styleClass="field-label" style="-fx-font-weight: bold;"/>
                                <Label fx:id="labelTipologia" text="BUG" styleClass="status-badge" style="-fx-background-color: #D1ECF1; -fx-text-fill: #0C5460;"/>
                            </HBox>

                            <!-- PRIORITA -->
                            <HBox alignment="CENTER_LEFT" spacing="10">
                                <Label text="Priorità :" styleClass="field-label" style="-fx-font-weight: bold;"/>
                                <Label fx:id="labelPriorita" text="ALTA" styleClass="status-badge" style="-fx-background-color: #F8D7DA; -fx-text-fill: #721C24;"/>
                                <javafx.scene.control.ComboBox fx:id="cmbPriorita" visible="false" managed="false"/>
                            </HBox>
                        </VBox>
                    </VBox>

                    <Region prefHeight="10" />

                    <!-- Description -->
                    <VBox spacing="5">
                        <Label text="Descrizione" styleClass="section-label" style="-fx-font-weight: bold;"/>
                        <Label fx:id="labelDescrizione" text="Descrizione dettagliata..." styleClass="section-content"/>
                    </VBox>

                    <!-- Technical Details (Dynamic) -->
                    <VBox fx:id="containerCampiSpecifici" spacing="5">
                        <!-- Fields populated via Code -->
                    </VBox>

                    <!-- Image Attachment -->
                    <VBox spacing="5" fx:id="imageContainer">
                        <Label text="Allegato" styleClass="section-label" style="-fx-font-weight: bold;"/>
                        <Label fx:id="labelNoAllegati" text="Non sono presenti allegati" visible="false" managed="false"/>
                        <ImageView fx:id="imageFoto" preserveRatio="true"/>
                    </VBox>

                </VBox>
            </ScrollPane>

            <!-- RIGHT PANE: Comments & History -->
            <SplitPane orientation="VERTICAL" dividerPositions="0.6">

                <!-- TOP RIGHT: Comments -->
                <VBox styleClass="side-panel" spacing="10">
                    <Label text="Commenti" styleClass="section-label" style="-fx-font-weight: bold;"/>
                    <ScrollPane fx:id="scrollPaneCommenti" fitToWidth="true" VBox.vgrow="ALWAYS" styleClass="comments-scroll">
                        <VBox fx:id="campiCommentiContainer" spacing="10" styleClass="comments-container">
                            <!-- Populated dynamically -->
                            <Label text="Nessun commento presente." fx:id="placeholderCommenti" styleClass="placeholder-text" visible="false" managed="false"/>
                        </VBox>
                    </ScrollPane>

                    <!-- Write Comment Section -->
                    <VBox spacing="5" styleClass="write-comment-box" style="-fx-border-color: #E0E0E0; -fx-border-width: 1 0 0 0; -fx-padding: 10 0 0 0;">
                        <Label text="Scrivi un commento" styleClass="section-label" style="-fx-font-size: 12px;"/>
                        <javafx.scene.control.TextArea fx:id="txtNuovoCommento" promptText="Inserisci il tuo commento qui..." wrapText="true" prefHeight="60"/>
                        <HBox alignment="CENTER_RIGHT">
                            <Button fx:id="btnInvia" text="Invia" onAction="#inviaCommento" styleClass="action-button" style="-fx-background-color: #2980B9; -fx-text-fill: white;"/>
                        </HBox>
                    </VBox>
                </VBox>

                <!-- BOTTOM RIGHT: History -->
                <VBox styleClass="side-panel" spacing="10">
                    <Label text="Cronologia Modifiche" styleClass="section-label" style="-fx-font-weight: bold;"/>
                    <VBox VBox.vgrow="ALWAYS" styleClass="placeholder-box">
                        <Label text="Area Cronologia (Presto disponibile)" styleClass="placeholder-text"/>
                    </VBox>
                </VBox>

            </SplitPane>

        </SplitPane>
    </center>
</BorderPane>
